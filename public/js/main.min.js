;(function(){"use strict";function checkWinner(){fb.child("/Games").child(thisGameUUID).on("value",function(a){var b=a.val();"player1"==b.winner.winner?alert("player1 Won the Game"):"player2"==b.winner.winner&&alert("player2 Won the Game")})}function assessMove(){$("td").one("click",function(){$(this).hasClass("X")&&5>=shots?(hits+=1,$(this).append(fire)):0>=shots&&alert("you ran out of ammo -- gameover"),hits>=3&&1==player1?fb.child("/Games").child(thisGameUUID).child("/winner").update({winner:"player1"}):hits>=3&&0==player1&&fb.child("/Games").child(thisGameUUID).child("/winner").update({winner:"player2"}),shots-=1}),checkWinner()}function createBoard(a){var b=$("<table></table>");a.forEach(function(a){var c=$("<tr></tr>");a.forEach(function(a){c.append($("<td class="+a+"></td>")),b.append(c)})}),$(".board").append(b),findCoords()}function sendBoardtoFB(){player1===!0?fb.child("/Games").child(thisGameUUID).child("/board1").set(board):fb.child("/Games").child(thisGameUUID).child("/board2").set(board)}function updateBoardArray(a,b){3>=shipNumber&&(b[a.row][a.col]="X")}function findCoords(){$("td").one("click",function(a){var b=findIndex(a.target);shipNumber+=1,3>=shipNumber&&$(this).append(ship),updateBoardArray(b,board)})}function findIndex(a){var b=$(a).closest("tr").index(),c=$(a).index();return{row:b,col:c}}function grabSecondBoard(){1==player1?fb.child("/Games").child(thisGameUUID).child("/board2").on("value",function(a){otherBoard=a.val()}):fb.child("/Games").child(thisGameUUID).child("/board1").on("value",function(a){otherBoard=a.val()})}var fb=new Firebase("https://battleship16.firebaseio.com/"),board=[["","","","",""],["","","","",""],["","","","",""],["","","","",""],["","","","",""]],otherBoard,ship='<img src=../imgs/submarine.png height="100px" width="100px">',fire='<img src=../imgs/fire.png height="100px" width="100px">',shipNumber=0,player1=!0,thisGameUUID,hits=0,shots=5;$(".start").on("click",function(){createBoard(board),$(".message1").append($("<h2>You Have 3 Submarines. Place Them Wisely.</h2>")),fb.child("/Games").limitToLast(1).once("value",function(a){var b=a.val(),c=b&&Object.keys(b)[0]||null,d=b&&b[c]||null;if(!b||d.p1&&d.p2){var e=fb.child("/Games").push({winner:!1,p1:"player1"});thisGameUUID=e.key()}else fb.child("/Games").child(c).update({p2:"player2"}),thisGameUUID=fb.child("/Games").child(c).key(),player1=!1;$(".start").hide(),$(".send").toggleClass("hidden")})}),$(".send").one("click",function(){$(".message1").hide(),shipNumber>=3?(sendBoardtoFB(),$(".send").toggleClass("hidden"),$(".play").toggleClass("hidden")):alert("you still have "+(3-shipNumber)+" ships to use!"),$("table").eq(0).hide()}),$(".play").on("click",function(){fb.child("/Games").child(thisGameUUID).child("/board2").on("value",function(a){var b=a.exists();0==b?alert("You have no one to play with, try waiting and clicking Play again"):(grabSecondBoard(),createBoard(otherBoard),assessMove(),$(".message2").append("<h2>You have 5 Missles. Fire them!</h2>"),$(".play").hide())})});}());